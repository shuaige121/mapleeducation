# Maple Sales Console (Flutter)

Internal sales workflow for Maple Education: client intake, service matching,
quotation/invoice/contract PDFs, and follow-up reminders.

## Setup
1. Firebase already configured to project `mapleeducation` (`lib/firebase_options.dart` generated via flutterfire).
2. Firebase Console → Authentication → Sign-in method: enable **Google** and **Anonymous**; add `mapleeducation.web.app` (and custom domains) to Authorized domains.
3. Storage is optional (PDF bytes kept in Firestore). Enable Storage only if you later need file uploads.
4. Legacy features pending: multi-language, legacy responsive layout, auto-sync worker (see `TODO.md`).

## Run
```bash
flutter pub get
flutter run -d chrome
```

## NAS push config
Default NAS endpoint is set to `http://192.168.7.19:8080/webhooks/documents`.
Override with `--dart-define` if needed.

If NAS accepts webhook pushes, you can set:

```bash
flutter run -d chrome \
  --dart-define=NAS_SYNC_ENABLED=true \
  --dart-define=NAS_SYNC_ENDPOINT=https://nas.example.com/webhooks/documents \
  --dart-define=NAS_SYNC_API_KEY=your_key
```

For internal http endpoints, add:
```bash
--dart-define=NAS_SYNC_REQUIRE_HTTPS=false
```

Custom auth header (optional):
```bash
--dart-define=NAS_SYNC_AUTH_HEADER=Authorization \
--dart-define=NAS_SYNC_AUTH_SCHEME=Bearer \
--dart-define=NAS_SYNC_AUTH_TOKEN=your_token
```

To host a simple NAS webhook in Docker, see `nas-webhook/README.md`.

## Build & Deploy (web)
```bash
flutter build web
firebase deploy --only hosting
firebase deploy --only firestore:rules
# Storage not required for current PDF flow (base64 in Firestore). Deploy storage only if you enable uploads.
```

## Collections
- clients
- services
- quotations
- invoices
- contracts
- reminders

## Notes
- Auth modes: Google sign-in + Guest (anonymous) sign-in (must be enabled in Firebase Auth).
- Documents: PDFs generated and stored as base64 in Firestore for history; download button uses generated bytes (no Firebase Storage needed).
- Google Calendar integration uses a pre-filled event link; users choose to add.
- NAS sync uses a push webhook (see `NAS_SYNC_*` settings).
- Legacy parity TODOs (see `TODO.md`): multi-language, legacy mobile layout, daily NAS sync worker, history list for docs.
